<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rifa 1 — Beneficente</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* CSS ORIGINAL INTEGRAL */
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Nunito',sans-serif;background:#f4f4f4;color:#222;font-size:17px}
.topo{background:#15803d;color:white;text-align:center;padding:28px 20px 34px}
.topo .badge{display:inline-block;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:3px 14px;font-size:0.8rem;font-weight:700;letter-spacing:1px;margin-bottom:10px}
.topo h1{font-size:1.75rem;font-weight:900;margin-bottom:8px;line-height:1.2}
.topo p{font-size:0.97rem;opacity:0.88;max-width:380px;margin:0 auto;line-height:1.5}
.card{background:white;margin:12px;border-radius:18px;padding:22px 18px;box-shadow:0 2px 8px rgba(0,0,0,0.07)}
.titulo{font-size:1.1rem;font-weight:800;color:#15803d;margin-bottom:12px;padding-bottom:10px;border-bottom:2px solid #f0fdf4}
.fotos{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.fw{border-radius:10px;overflow:hidden;background:#000}
.fw.full{grid-column:span 2}
.fw img{width:100%;display:block;object-fit:contain;max-height:260px;background:#111}
.fw.full img{max-height:290px}
.legenda{display:flex;gap:12px;margin-bottom:14px;flex-wrap:wrap}
.li{display:flex;align-items:center;gap:6px;font-size:0.88rem;font-weight:700}
.lc{width:18px;height:18px;border-radius:4px;flex-shrink:0}
.lc.livre{background:#f9fafb;border:2px solid #d1d5db}
.lc.vendida{background:#fca5a5;border:2px solid #f87171}
.lc.escolhida{background:#22c55e;border:2px solid #16a34a}
.grade{display:grid;grid-template-columns:repeat(auto-fill,minmax(50px,1fr));gap:6px}
.cota{aspect-ratio:1;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;cursor:pointer;border:2px solid transparent;transition:transform .12s;user-select:none;-webkit-tap-highlight-color:transparent}
.cota.livre{background:#f9fafb;border-color:#d1d5db;color:#374151}
.cota.vendida{background:#fee2e2;border-color:#fca5a5;color:#b91c1c;cursor:default}
.cota.escolhida{background:#22c55e!important;border-color:#16a34a!important;color:white!important;transform:scale(1.1);box-shadow:0 3px 10px rgba(22,163,74,.35)}
.btn-admin{display:block;width:100%;background:none;border:2px dashed #e5e7eb;border-radius:10px;padding:9px;color:#d1d5db;font-size:0.78rem;cursor:pointer;margin-top:12px}
.painel-admin{display:none;background:#fffbeb;border:2px solid #fde068;border-radius:12px;padding:14px;margin-top:8px}
.painel-admin.show{display:block}
.admin-input{width:100%;border:2px solid #fde068;border-radius:9px;padding:10px 13px;margin-bottom:8px}
.btn-admin-entrar{width:100%;background:#ca8a04;color:white;border:none;border-radius:9px;padding:11px;font-weight:800;cursor:pointer}
.aviso-admin{display:none;background:#ca8a04;color:white;text-align:center;padding:9px;font-weight:800;position:sticky;top:0;z-index:40}
.aviso-admin.show{display:flex;align-items:center;justify-content:center;gap:10px}
.btn-salvar{background:white;color:#92400e;border:none;border-radius:8px;padding:7px 14px;font-weight:900;cursor:pointer}
.barra{position:fixed;bottom:0;left:0;right:0;background:#15803d;color:white;padding:12px 16px;display:none;align-items:center;justify-content:space-between;z-index:50}
.barra.show{display:flex}
.btn-pagar{background:white;color:#15803d;border:none;border-radius:11px;padding:12px 18px;font-weight:900;cursor:pointer}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:100;align-items:flex-end;justify-content:center}
.overlay.show{display:flex}
.modal{background:white;border-radius:26px 26px 0 0;padding:26px 20px 44px;width:100%;max-width:460px}
.campo input{width:100%;border:2px solid #d1d5db;border-radius:11px;padding:13px 15px;font-size:1rem;margin-top:10px}
.btn-wpp-modal{width:100%;background:#25D366;color:white;border:none;border-radius:13px;padding:16px;font-size:1.1rem;font-weight:900;cursor:pointer;margin-top:15px}
</style>
</head>
<body>

<div class="aviso-admin" id="avisoAdmin">
  <span>MODO EDIÇÃO</span>
  <button class="btn-salvar" onclick="salvarAlteracoes()">Salvar Alterações</button>
</div>

<div class="topo">
  <div class="badge">RIFA 1</div>
  <h1>Rifa Beneficente</h1>
  <p>Concorra a um <strong>Cooktop Britânia</strong> e ajude nossa família.</p>
</div>

<div class="card">
  <div class="titulo">O que aconteceu</div>
  <p style="font-size:0.97rem;line-height:1.75;color:#333">Na madrugada de 26 de fevereiro, meu esposo Junior capotou o veículo de trabalho...</p>
</div>

<div class="card">
  <div class="titulo">Escolha suas cotas</div>
  <div class="legenda">
    <div class="li"><div class="lc livre"></div> Livre</div>
    <div class="li"><div class="lc vendida"></div> Vendida</div>
    <div class="li"><div class="lc escolhida"></div> Selecionada</div>
  </div>
  <div id="grade" class="grade">Carregando números...</div>
  
  <button class="btn-admin" onclick="document.getElementById('painelAdmin').classList.toggle('show')">Acesso Administrativo</button>
  <div class="painel-admin" id="painelAdmin">
    <input type="password" id="senhaAdmin" class="admin-input" placeholder="Senha">
    <button class="btn-admin-entrar" onclick="entrarAdmin()">Entrar</button>
  </div>
</div>

<div class="barra" id="barra">
  <div id="infoSelecao"></div>
  <button class="btn-pagar" onclick="abrirModal()">Reservar</button>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <h3>Reservar Cotas</h3>
    <input type="text" id="nome" class="campo" placeholder="Seu Nome">
    <input type="tel" id="fone" class="campo" placeholder="Seu WhatsApp">
    <button class="btn-wpp-modal" onclick="finalizar()">Confirmar no WhatsApp</button>
    <button onclick="fecharModal()" style="width:100%; margin-top:10px; background:none; border:none; color:#999;">Cancelar</button>
  </div>
</div>

<script>
const BIN_ID = "69a310b7d0ea881f40e23b46";
const MASTER_KEY = "$2a$10$WwDMzPOtIBIA3CS8Ihqm5uV3j06Dip8IJLXRqHBI7T/Pg.mfrSDAS";
const RIFA_KEY = "rifa1";
const WPP_NUM = "5516997733349"; 

let ocupados = [];
let escolhidos = [];
let modoAdmin = false;

async function carregar() {
    try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: { "X-Master-Key": MASTER_KEY }
        });
        const data = await res.json();
        ocupados = data.record[RIFA_KEY] || [];
        desenharGrade();
    } catch (e) { alert("Erro ao carregar dados."); }
}

function desenharGrade() {
    const grade = document.getElementById('grade');
    grade.innerHTML = '';
    for (let i = 1; i <= 100; i++) {
        const n = i.toString().padStart(2, '0');
        const div = document.createElement('div');
        const estaVendido = ocupados.includes(n);
        const estaEscolhido = escolhidos.includes(n);
        
        div.className = `cota ${estaVendido ? 'vendida' : 'livre'}`;
        if (estaEscolhido) div.classList.add('escolhida');
        div.textContent = n;

        div.onclick = () => clicarCota(n);
        grade.appendChild(div);
    }
}

function clicarCota(n) {
    if (modoAdmin) {
        if (ocupados.includes(n)) {
            ocupados = ocupados.filter(x => x !== n);
        } else {
            ocupados.push(n);
        }
        desenharGrade();
        return;
    }

    if (ocupados.includes(n)) return;

    if (escolhidos.includes(n)) {
        escolhidos = escolhidos.filter(x => x !== n);
    } else {
        escolhidos.push(n);
    }
    desenharGrade();
    atualizarBarra();
}

function atualizarBarra() {
    const barra = document.getElementById('barra');
    if (escolhidos.length > 0) {
        barra.classList.add('show');
        document.getElementById('infoSelecao').innerHTML = `<strong>${escolhidos.length} cotas</strong>`;
    } else {
        barra.classList.remove('show');
    }
}

function entrarAdmin() {
    if (document.getElementById('senhaAdmin').value === "123") {
        modoAdmin = true;
        document.getElementById('avisoAdmin').classList.add('show');
        document.getElementById('painelAdmin').classList.remove('show');
    } else { alert("Senha errada"); }
}

async function salvarAlteracoes() {
    try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: { "X-Master-Key": MASTER_KEY }
        });
        const data = await res.json();
        let record = data.record;
        record[RIFA_KEY] = ocupados;

        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
            method: 'PUT',
            headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
            body: JSON.stringify(record)
        });
        alert("Salvo!");
        location.reload();
    } catch (e) { alert("Erro ao salvar"); }
}

function abrirModal() { document.getElementById('overlay').classList.add('show'); }
function fecharModal() { document.getElementById('overlay').classList.remove('show'); }

async function finalizar() {
    const nome = document.getElementById('nome').value;
    if(!nome) return alert("Digite seu nome");
    
    // Bloqueia no banco antes de enviar
    ocupados = [...ocupados, ...escolhidos];
    await salvarAlteracoes();

    const msg = encodeURIComponent(`Olá Lívia! Reservei as cotas: ${escolhidos.join(', ')}\nNome: ${nome}`);
    window.open(`https://wa.me/${WPP_NUM}?text=${msg}`);
}

carregar();
</script>
</body>
</html>
